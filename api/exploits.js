document.addEventListener("DOMContentLoaded", () => {

    const list = document.getElementById("exploit-list");

    /* ===============================
       FETCH API DENGAN AUTO RETRY
    =============================== */
    async function fetchWeaoStatus(retries = 3, delay = 1000) {
        for (let attempt = 1; attempt <= retries; attempt++) {
            try {
                const res = await fetch("https://bennnyr.com/api/weao-status", {
                    method: "GET",
                    headers: {
                        "Accept": "application/json"
                    }
                });

                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }

                return await res.json();

            } catch (err) {
                console.warn(`WEAO API gagal (attempt ${attempt})`, err);

                if (attempt < retries) {
                    await new Promise(r => setTimeout(r, delay));
                } else {
                    return null;
                }
            }
        }
    }

    /* ===============================
       RENDER DATA KE HALAMAN
    =============================== */
    function renderStatus(data) {
        if (!list) return;

        list.innerHTML = "";

        if (!data || !data.data || data.data.length === 0) {
            list.innerHTML = "<p>Failed to load data.</p>";
            return;
        }

        data.data.forEach(item => {
            const card = document.createElement("div");
            card.className = "card";

            const statusClass =
                item.status === "working" ? "working" :
                item.status === "patched" ? "patched" :
                "unknown";

            card.innerHTML = `
                <h2>${item.name || "Unknown"}</h2>
                <p>Platform: ${item.platform || "N/A"}</p>
                <span class="badge ${statusClass}">
                    ${item.status?.toUpperCase() || "UNKNOWN"}
                </span>
            `;

            list.appendChild(card);
        });
    }

    /* ===============================
       LOAD DATA
    =============================== */
    async function loadData() {
        if (list) {
            list.innerHTML = "<p>Loading data...</p>";
        }

        const data = await fetchWeaoStatus();
        renderStatus(data);
    }

    /* ===============================
       START
    =============================== */
    loadData();

});
